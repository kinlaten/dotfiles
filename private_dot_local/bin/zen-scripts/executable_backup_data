#!/bin/bash

# --- Configuration Variables ---
# Use full paths for source and destination to avoid PATH issues when run as root
SOURCE_DIR="/mnt/zen_data/"
DEST_DIR="/media/zen/E8F7-7D34/"

# --- Pre-check: Does destination exist? ---
if [ ! -d "$DEST_DIR" ]; then
    echo "Error: Destination directory '$DEST_DIR' does not exist." >&2 # Redirect error to stderr
    echo "Please ensure your HDD is attached and mounted correctly." >&2
    exit 1
fi

# --- Main rsync operation ---
echo "Starting rsync from '$SOURCE_DIR' to '$DEST_DIR'..."
# Use full path for rsync itself
/usr/bin/rsync -avh --delete "$SOURCE_DIR" "$DEST_DIR"

# --- Post-check: rsync exit status ---
RSYNC_EXIT_CODE=$? # Capture rsync's exit code immediately
if [ "$RSYNC_EXIT_CODE" -eq 0 ]; then
    echo "Rsync completed successfully."
else
    echo "Rsync encountered an error. Exit code: $RSYNC_EXIT_CODE" >&2
fi

exit "$RSYNC_EXIT_CODE" # Exit with rsync's original exit code
